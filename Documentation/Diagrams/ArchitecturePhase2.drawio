<mxfile host="Electron" modified="2023-04-13T14:59:08.720Z" agent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) draw.io/21.1.2 Chrome/106.0.5249.199 Electron/21.4.3 Safari/537.36" etag="n_IzXVsRJjO59a0cvpct" version="21.1.2" type="device">
  <diagram name="Page-1" id="c4acf3e9-155e-7222-9cf6-157b1a14988f">
    <mxGraphModel dx="1430" dy="837" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="850" pageHeight="1100" background="none" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="kgQ1zfpZOyFQZ4Gz7q0x-7" value="LAN" style="shape=umlFrame;whiteSpace=wrap;html=1;rounded=0;shadow=0;comic=0;labelBackgroundColor=none;strokeWidth=1;fontFamily=Verdana;fontSize=10;align=center;width=160;height=30;" vertex="1" parent="1">
          <mxGeometry x="20" y="560" width="750" height="480" as="geometry" />
        </mxCell>
        <mxCell id="17acba5748e5396b-1" value="WAN&amp;nbsp;" style="shape=umlFrame;whiteSpace=wrap;html=1;rounded=0;shadow=0;comic=0;labelBackgroundColor=none;strokeWidth=1;fontFamily=Verdana;fontSize=10;align=center;width=160;height=30;" parent="1" vertex="1">
          <mxGeometry x="20" y="70" width="750" height="490" as="geometry" />
        </mxCell>
        <mxCell id="5d2195bd80daf111-41" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;dashed=1;labelBackgroundColor=none;startFill=0;endArrow=open;endFill=0;endSize=10;fontFamily=Verdana;fontSize=10;" parent="1" source="5d2195bd80daf111-5" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
            <mxPoint x="730" y="628" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="5d2195bd80daf111-26" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;dashed=1;labelBackgroundColor=none;startFill=0;endArrow=open;endFill=0;endSize=10;fontFamily=Verdana;fontSize=10;" parent="1" target="5d2195bd80daf111-17" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
            <mxPoint x="640" y="300" as="sourcePoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="5d2195bd80daf111-25" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;dashed=1;labelBackgroundColor=none;startFill=0;endArrow=open;endFill=0;endSize=10;fontFamily=Verdana;fontSize=10;" parent="1" source="5d2195bd80daf111-19" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="370" y="340" />
              <mxPoint x="370" y="300" />
            </Array>
            <mxPoint x="450" y="300" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="5d2195bd80daf111-27" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;exitX=1;exitY=0.75;dashed=1;labelBackgroundColor=none;startFill=0;endArrow=open;endFill=0;endSize=10;fontFamily=Verdana;fontSize=10;" parent="1" target="5d2195bd80daf111-14" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="320" y="375" />
              <mxPoint x="320" y="440" />
            </Array>
            <mxPoint x="250" y="375" as="sourcePoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="5d2195bd80daf111-28" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;dashed=1;labelBackgroundColor=none;startFill=0;endArrow=open;endFill=0;endSize=10;fontFamily=Verdana;fontSize=10;" parent="1" source="5d2195bd80daf111-20" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="320" y="490" />
              <mxPoint x="320" y="460" />
            </Array>
            <mxPoint x="380" y="460" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="5d2195bd80daf111-29" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;dashed=1;labelBackgroundColor=none;startFill=0;endArrow=open;endFill=0;endSize=10;fontFamily=Verdana;fontSize=10;" parent="1" source="5d2195bd80daf111-20" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="380" y="520" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="kgQ1zfpZOyFQZ4Gz7q0x-13" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="kgQ1zfpZOyFQZ4Gz7q0x-8" target="kgQ1zfpZOyFQZ4Gz7q0x-11">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="50" y="160" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="kgQ1zfpZOyFQZ4Gz7q0x-14" value="HTTPS" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="kgQ1zfpZOyFQZ4Gz7q0x-13">
          <mxGeometry x="-0.3714" y="-3" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="kgQ1zfpZOyFQZ4Gz7q0x-16" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="kgQ1zfpZOyFQZ4Gz7q0x-8" target="kgQ1zfpZOyFQZ4Gz7q0x-15">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="130" y="485" />
              <mxPoint x="130" y="400" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="kgQ1zfpZOyFQZ4Gz7q0x-17" value="Downloads&lt;br&gt;&amp;amp; uses" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="kgQ1zfpZOyFQZ4Gz7q0x-16">
          <mxGeometry x="-0.1966" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="kgQ1zfpZOyFQZ4Gz7q0x-8" value="User" style="shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top;html=1;outlineConnect=0;" vertex="1" parent="1">
          <mxGeometry x="40" y="440" width="45" height="90" as="geometry" />
        </mxCell>
        <mxCell id="kgQ1zfpZOyFQZ4Gz7q0x-11" value="&lt;b&gt;SPA&lt;br&gt;&lt;/b&gt;Azure WebApp&lt;br&gt;&lt;br&gt;www.smarthome.com&amp;nbsp;&lt;br&gt;(example domain name)" style="image;aspect=fixed;html=1;points=[];align=center;fontSize=12;image=img/lib/azure2/app_services/App_Services.svg;" vertex="1" parent="1">
          <mxGeometry x="120" y="130" width="60" height="60" as="geometry" />
        </mxCell>
        <mxCell id="kgQ1zfpZOyFQZ4Gz7q0x-15" value="&lt;b&gt;Electron/Tauri&amp;nbsp;&lt;br&gt;Mobile App&lt;br&gt;&lt;/b&gt;" style="image;points=[];aspect=fixed;html=1;align=center;shadow=0;dashed=0;image=img/lib/allied_telesis/computer_and_terminals/Smartphone.svg;" vertex="1" parent="1">
          <mxGeometry x="170" y="340" width="35.2" height="76.8" as="geometry" />
        </mxCell>
        <mxCell id="kgQ1zfpZOyFQZ4Gz7q0x-21" value="" style="endArrow=classic;html=1;rounded=0;exitX=-0.078;exitY=0.516;exitDx=0;exitDy=0;exitPerimeter=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;entryPerimeter=0;edgeStyle=orthogonalEdgeStyle;" edge="1" parent="1" source="kgQ1zfpZOyFQZ4Gz7q0x-15" target="kgQ1zfpZOyFQZ4Gz7q0x-8">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="260" y="315" as="sourcePoint" />
            <mxPoint x="310" y="265" as="targetPoint" />
            <Array as="points">
              <mxPoint x="63" y="380" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="kgQ1zfpZOyFQZ4Gz7q0x-22" value="push&lt;br&gt;notifications" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="kgQ1zfpZOyFQZ4Gz7q0x-21">
          <mxGeometry x="-0.1634" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="kgQ1zfpZOyFQZ4Gz7q0x-23" value="" style="endArrow=classic;html=1;rounded=0;exitX=0.517;exitY=-0.024;exitDx=0;exitDy=0;exitPerimeter=0;entryX=0.994;entryY=0.637;entryDx=0;entryDy=0;entryPerimeter=0;edgeStyle=orthogonalEdgeStyle;" edge="1" parent="1" source="kgQ1zfpZOyFQZ4Gz7q0x-15" target="kgQ1zfpZOyFQZ4Gz7q0x-11">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="470" y="380" as="sourcePoint" />
            <mxPoint x="520" y="330" as="targetPoint" />
            <Array as="points">
              <mxPoint x="230" y="338" />
              <mxPoint x="230" y="168" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="kgQ1zfpZOyFQZ4Gz7q0x-24" value="HTTPS" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="kgQ1zfpZOyFQZ4Gz7q0x-23">
          <mxGeometry x="-0.336" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="kgQ1zfpZOyFQZ4Gz7q0x-31" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="kgQ1zfpZOyFQZ4Gz7q0x-26" target="kgQ1zfpZOyFQZ4Gz7q0x-30">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="kgQ1zfpZOyFQZ4Gz7q0x-32" value="HTTPS" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="kgQ1zfpZOyFQZ4Gz7q0x-31">
          <mxGeometry x="-0.2351" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="kgQ1zfpZOyFQZ4Gz7q0x-36" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;startArrow=classic;startFill=1;" edge="1" parent="1" source="kgQ1zfpZOyFQZ4Gz7q0x-26" target="kgQ1zfpZOyFQZ4Gz7q0x-35">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="360" y="150" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="kgQ1zfpZOyFQZ4Gz7q0x-37" value="Service pushes user events&lt;br&gt;&lt;br&gt;Service polls for device events" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="kgQ1zfpZOyFQZ4Gz7q0x-36">
          <mxGeometry x="0.1451" relative="1" as="geometry">
            <mxPoint y="16" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="kgQ1zfpZOyFQZ4Gz7q0x-26" value="&lt;b&gt;SmartHome.Service&lt;/b&gt;&lt;br&gt;&lt;br&gt;www.smarthome.com/api/" style="image;aspect=fixed;html=1;points=[];align=center;fontSize=12;image=img/lib/azure2/app_services/App_Services.svg;" vertex="1" parent="1">
          <mxGeometry x="425" y="110" width="64" height="64" as="geometry" />
        </mxCell>
        <mxCell id="kgQ1zfpZOyFQZ4Gz7q0x-28" value="" style="endArrow=classic;html=1;rounded=0;exitX=1.033;exitY=0.152;exitDx=0;exitDy=0;exitPerimeter=0;edgeStyle=orthogonalEdgeStyle;entryX=0.005;entryY=0.448;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="1" source="kgQ1zfpZOyFQZ4Gz7q0x-11" target="kgQ1zfpZOyFQZ4Gz7q0x-26">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="470" y="330" as="sourcePoint" />
            <mxPoint x="520" y="280" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="kgQ1zfpZOyFQZ4Gz7q0x-29" value="HTTPS" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="kgQ1zfpZOyFQZ4Gz7q0x-28">
          <mxGeometry x="-0.2339" y="-1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="kgQ1zfpZOyFQZ4Gz7q0x-30" value="&lt;b&gt;DB&lt;/b&gt;&lt;br&gt;&lt;br&gt;Either Cosmos DB with collection&lt;br&gt;per subdomain, or SQL instance with&lt;br&gt;DB per subdomain&lt;br&gt;(TBD based on costs)" style="image;aspect=fixed;html=1;points=[];align=center;fontSize=12;image=img/lib/azure2/databases/Azure_Cosmos_DB.svg;" vertex="1" parent="1">
          <mxGeometry x="633" y="110" width="64" height="64" as="geometry" />
        </mxCell>
        <mxCell id="kgQ1zfpZOyFQZ4Gz7q0x-35" value="&lt;b&gt;Azure Event Hub&lt;/b&gt;" style="image;aspect=fixed;html=1;points=[];align=center;fontSize=12;image=img/lib/azure2/analytics/Event_Hubs.svg;" vertex="1" parent="1">
          <mxGeometry x="330" y="380" width="67" height="60" as="geometry" />
        </mxCell>
        <mxCell id="kgQ1zfpZOyFQZ4Gz7q0x-41" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;startArrow=classic;startFill=1;" edge="1" parent="1" source="kgQ1zfpZOyFQZ4Gz7q0x-38" target="kgQ1zfpZOyFQZ4Gz7q0x-35">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="300" y="410" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="kgQ1zfpZOyFQZ4Gz7q0x-42" value="Device events pushed to Azure hub&lt;br&gt;&lt;br&gt;User events polled from Azure hub to&amp;nbsp;&lt;br&gt;local hub" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="kgQ1zfpZOyFQZ4Gz7q0x-41">
          <mxGeometry x="0.1012" y="1" relative="1" as="geometry">
            <mxPoint x="8" y="-11" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="kgQ1zfpZOyFQZ4Gz7q0x-38" value="&lt;b&gt;SmartHome Hub&lt;/b&gt;&lt;br&gt;&lt;br&gt;Local gateway service&lt;br&gt;&amp;amp; local event hub" style="image;points=[];aspect=fixed;html=1;align=center;shadow=0;dashed=0;image=img/lib/allied_telesis/computer_and_terminals/Server_Desktop.svg;" vertex="1" parent="1">
          <mxGeometry x="270" y="650" width="63.11" height="80" as="geometry" />
        </mxCell>
        <mxCell id="kgQ1zfpZOyFQZ4Gz7q0x-40" value="NB: I&#39;m still toying around with the idea of keeping the local system in charge of the data, but a consumer system can&#39;t really listen for requests from a user (mainly because that involves port forwarding)&lt;br&gt;&lt;br&gt;Maybe we can come up with a system with a locally hosted write store populated by events from devices and from the Azure event hub (from users), with integration events that populate data into a read store hosted by Azure" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;align=left;" vertex="1" parent="1">
          <mxGeometry x="460" y="700" width="290" height="160" as="geometry" />
        </mxCell>
        <mxCell id="kgQ1zfpZOyFQZ4Gz7q0x-43" value="" style="image;points=[];aspect=fixed;html=1;align=center;shadow=0;dashed=0;image=img/lib/allied_telesis/computer_and_terminals/Server_Desktop.svg;" vertex="1" parent="1">
          <mxGeometry x="258.94" y="890" width="55.22" height="70" as="geometry" />
        </mxCell>
        <mxCell id="kgQ1zfpZOyFQZ4Gz7q0x-44" value="" style="image;points=[];aspect=fixed;html=1;align=center;shadow=0;dashed=0;image=img/lib/allied_telesis/computer_and_terminals/Server_Desktop.svg;" vertex="1" parent="1">
          <mxGeometry x="268.94" y="900" width="55.22" height="70" as="geometry" />
        </mxCell>
        <mxCell id="kgQ1zfpZOyFQZ4Gz7q0x-45" value="" style="image;points=[];aspect=fixed;html=1;align=center;shadow=0;dashed=0;image=img/lib/allied_telesis/computer_and_terminals/Server_Desktop.svg;" vertex="1" parent="1">
          <mxGeometry x="278.94" y="910" width="55.22" height="70" as="geometry" />
        </mxCell>
        <mxCell id="kgQ1zfpZOyFQZ4Gz7q0x-46" value="&lt;b&gt;IoT Devices&lt;br&gt;&lt;/b&gt;" style="image;points=[];aspect=fixed;html=1;align=center;shadow=0;dashed=0;image=img/lib/allied_telesis/computer_and_terminals/Server_Desktop.svg;" vertex="1" parent="1">
          <mxGeometry x="288.94" y="920" width="55.22" height="70" as="geometry" />
        </mxCell>
        <mxCell id="kgQ1zfpZOyFQZ4Gz7q0x-47" value="" style="endArrow=classic;html=1;rounded=0;entryX=-0.035;entryY=0.543;entryDx=0;entryDy=0;entryPerimeter=0;edgeStyle=orthogonalEdgeStyle;" edge="1" parent="1" target="kgQ1zfpZOyFQZ4Gz7q0x-43">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="270" y="690" as="sourcePoint" />
            <mxPoint x="175" y="665" as="targetPoint" />
            <Array as="points">
              <mxPoint x="269" y="690" />
              <mxPoint x="210" y="690" />
              <mxPoint x="210" y="928" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="kgQ1zfpZOyFQZ4Gz7q0x-48" value="Propogates user events&lt;br&gt;to relevant devices via&lt;br&gt;local event bus" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="kgQ1zfpZOyFQZ4Gz7q0x-47">
          <mxGeometry x="0.0837" relative="1" as="geometry">
            <mxPoint y="28" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="kgQ1zfpZOyFQZ4Gz7q0x-49" value="" style="endArrow=classic;html=1;rounded=0;exitX=1.047;exitY=0.239;exitDx=0;exitDy=0;exitPerimeter=0;entryX=1.02;entryY=0.489;entryDx=0;entryDy=0;entryPerimeter=0;edgeStyle=orthogonalEdgeStyle;" edge="1" parent="1" source="kgQ1zfpZOyFQZ4Gz7q0x-46" target="kgQ1zfpZOyFQZ4Gz7q0x-38">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="390" y="920" as="sourcePoint" />
            <mxPoint x="440" y="870" as="targetPoint" />
            <Array as="points">
              <mxPoint x="390" y="937" />
              <mxPoint x="390" y="689" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="kgQ1zfpZOyFQZ4Gz7q0x-50" value="Pushes device events&lt;br&gt;to local event bus" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="kgQ1zfpZOyFQZ4Gz7q0x-49">
          <mxGeometry x="-0.3274" y="-2" relative="1" as="geometry">
            <mxPoint x="-2" y="-13" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="kgQ1zfpZOyFQZ4Gz7q0x-52" value="NB: exact mechanism for event bus connection TBD, we may not actually have to poll anything, a SignalR connection for asynchronous communication may be more resource efficient &amp;amp; responsive&lt;br&gt;&lt;br&gt;Same goes for SmartHome Hub&#39;s connection to the Azure hub" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;align=left;" vertex="1" parent="1">
          <mxGeometry x="490" y="318.4" width="205" height="131.6" as="geometry" />
        </mxCell>
        <mxCell id="kgQ1zfpZOyFQZ4Gz7q0x-56" value="Bidirectional arrow represents data flow, in reality the SmartHome Hub will always initiate requests to the Azure Event Hub, which will be publicly accessible. The data flow from Azure to LAN will come from polling via HTTPS, or from a SignalR connection opened by the local hub. The SmartHome Hub will NOT be accessible from outside the LAN" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;align=left;" vertex="1" parent="1">
          <mxGeometry x="339" y="530" width="356" height="100" as="geometry" />
        </mxCell>
        <mxCell id="kgQ1zfpZOyFQZ4Gz7q0x-53" value="" style="sketch=0;aspect=fixed;pointerEvents=1;shadow=0;dashed=0;html=1;labelPosition=center;verticalLabelPosition=bottom;verticalAlign=top;align=center;shape=mxgraph.mscae.enterprise.firewall;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="271.55" y="540" width="50" height="44" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
